define(function(){"use strict";var e={heading1:["formatblock","<h1>"],heading2:["formatblock","<h2>"],heading3:["formatblock","<h3>"],heading4:["formatblock","<h4>"],heading5:["formatblock","<h5>"],heading6:["formatblock","<h6>"],paragraph:["formatblock","<p>"],bold:"bold",italic:"italic",orderedlist:"insertorderedlist",unorderedlist:"insertunorderedlist",undo:"undo",redo:"redo",link:function(){var e=prompt("Please enter a URL to link to");this.action(["createlink",e])},viewsource:function(){this.toggle()}};return function(n,r){var i=this;this.textarea=n;this.iframe=document.createElement("iframe");this.wysiwygview=true;var s=function(){this.textarea.parentNode.insertBefore(this.iframe,this.textarea.nextSibling);this.textarea.style.display="none";this.iframe.frameBorder=0;this.iframe.src="#";this.iframe.onload=function(){i.win=i.iframe.contentWindow;i.doc=i.win.document;i.doc.body.innerHTML=i.textarea.value;i.doc.body.contentEditable=true;i.doc.addEventListener("keypress",i.listener.bind(i),true)}};var o=function(){for(var t=0,n=r.buttons.length;t<n;t++){r.buttons[t].addEventListener("click",function(t){t.preventDefault();var n=e[this.getAttribute("data-action")];typeof n==="function"?n.call(i):i.action(n)})}};this.listener=function(e){if(e.shiftKey&&e.keyCode==13){e.preventDefault();this.action(0,"<br />\n")}};this.focus=function(){(this.wysiwygview?this.iframe.contentWindow:this.textarea).focus()};this.action=function(e,t){if(typeof e=="string")e=[e];if(this.wysiwygview){this.doc.execCommand(e[0],false,e[1])}else if(t){var n=this.textarea.selectionStart,r=this.textarea.selectionEnd,i=this.textarea.value,s=function(e,t){return e.replace("$",t||"").replace(/#/g,"\n")};this.textarea.value=i.substring(0,n)+s(t,i.substring(n,r))+i.substring(r,i.length)}this.focus()};this.toggle=function(){this.wysiwygview=!!this.textarea.offsetHeight*1;this.wysiwygview?this.doc.body.innerHTML=this.textarea.value:this.textarea.value=this.doc.body.innerHTML;var e=["textarea","iframe"];this[e[this.wysiwygview]].style.display=null;this[e[!this.wysiwygview*1]].style.display="none"};s.call(this);o.call(this)}})